<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>YYText问题</title>
      <link href="/blog_web/2024/06/28/YYText%E9%97%AE%E9%A2%98/"/>
      <url>/blog_web/2024/06/28/YYText%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="一、适配暗色模式时，YYLabel强制设置-overrideUserInterfaceStyle-为dark-系统为light-时-dark-不生效"><a href="#一、适配暗色模式时，YYLabel强制设置-overrideUserInterfaceStyle-为dark-系统为light-时-dark-不生效" class="headerlink" title="一、适配暗色模式时，YYLabel强制设置 overrideUserInterfaceStyle 为dark 系统为light 时 dark 不生效"></a>一、适配暗色模式时，<code>YYLabel</code>强制设置 <code>overrideUserInterfaceStyle</code> 为<code>dark</code> 系统为<code>light</code> 时 <code>dark</code> 不生效</h2><p><code>YYLabel</code>中使用<code>YYTextLayout</code>进行布局， <code>YYTextLayout</code>绘制采用的是<code>CoreText</code>，<br><code>CoreText</code>在绘制时其中的颜色环境信息从 <code>UITraitCollection.currentTraitCollection</code> 中获取</p><p><code>UITraitCollection.currentTraitCollection</code> 官方文档DEMO</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">updateBorderColor</span>(<span class="params">layer</span>: <span class="type">CALayer</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> savedTraitCollection <span class="operator">=</span> <span class="type">UITraitCollection</span>.current</span><br><span class="line">    <span class="comment">// Set the property with a trait collection from a view.</span></span><br><span class="line">    <span class="type">UITraitCollection</span>.current <span class="operator">=</span> view.traitCollection</span><br><span class="line">    <span class="comment">// Methods and properties relying on current are safe to use here.</span></span><br><span class="line">    layer.borderColor <span class="operator">=</span> <span class="type">UIColor</span>.label.cgColor</span><br><span class="line">    <span class="comment">// Restore the saved collection.</span></span><br><span class="line">    <span class="type">UITraitCollection</span>.current <span class="operator">=</span> savedTraitCollection</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只需在<code>YYLabel</code> 中 <code>newAsyncDisplayTask</code> 绘制任务中重新修改<code>UITraitCollection.current</code>为YYLabel中的<code>traitCollection</code> ，然后绘制完成还原<code>UITraitCollection.current</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> (<span class="type">YYTextAsyncLayerDisplayTask</span> <span class="operator">*</span>)newAsyncDisplayTask &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// create display task</span></span><br><span class="line">    <span class="type">YYTextAsyncLayerDisplayTask</span> <span class="operator">*</span>task <span class="operator">=</span> [<span class="type">YYTextAsyncLayerDisplayTask</span> new];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)) &#123;</span><br><span class="line">        task.savedCurrentTraitCollection <span class="operator">=</span> <span class="type">UITraitCollection</span>.currentTraitCollection;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    task.willDisplay <span class="operator">=</span> <span class="operator">^</span>(<span class="type">CALayer</span> <span class="operator">*</span>layer) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)) &#123;</span><br><span class="line">            <span class="type">UITraitCollection</span>.currentTraitCollection <span class="operator">=</span> <span class="keyword">self</span>.traitCollection;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ...</span></span><br><span class="line"></span><br><span class="line">    __weak <span class="type">YYTextAsyncLayerDisplayTask</span> <span class="operator">*</span>weakTask <span class="operator">=</span> task;</span><br><span class="line">    task.didDisplay <span class="operator">=</span> <span class="operator">^</span>(<span class="type">CALayer</span> <span class="operator">*</span>layer, <span class="type">BOOL</span> finished) &#123;</span><br><span class="line">        <span class="comment">/// ...</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)) &#123;</span><br><span class="line">            <span class="type">UITraitCollection</span>.currentTraitCollection <span class="operator">=</span> weakTask.savedCurrentTraitCollection;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> task;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在暗色、亮色切换时在加上刷新</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> (void)traitCollectionDidChange:(<span class="type">UITraitCollection</span> <span class="operator">*</span>)previousTraitCollection &#123;</span><br><span class="line">    [<span class="keyword">super</span> traitCollectionDidChange:previousTraitCollection];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>([<span class="type">UITraitCollection</span>.currentTraitCollection hasDifferentColorAppearanceComparedToTraitCollection:previousTraitCollection])&#123;</span><br><span class="line">            [<span class="keyword">self</span> _setLayoutNeedUpdate];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="二、YYTextView-在-iOS15-后-粘贴时-总是弹出粘贴板权限影响用户体验"><a href="#二、YYTextView-在-iOS15-后-粘贴时-总是弹出粘贴板权限影响用户体验" class="headerlink" title="二、YYTextView 在 iOS15 后 粘贴时 总是弹出粘贴板权限影响用户体验"></a>二、<code>YYTextView</code> 在 <code>iOS15</code> 后 粘贴时 总是弹出粘贴板权限影响用户体验</h2><p>在 _isPasteboardContainsValidValue 方法中直接取string作为判断粘贴板中是否有数据<br>只要掉用 pasteboard.string 系统就会弹出权限</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIPasteboard</span> <span class="operator">*</span>pasteboard <span class="operator">=</span> [<span class="type">UIPasteboard</span> generalPasteboard];</span><br><span class="line"><span class="keyword">if</span> (pasteboard.string.length <span class="operator">&gt;</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改成取<code>UIPasteboard</code>的<code>hasStrings</code>方法判断粘贴板中是否有数据</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIPasteboard</span> <span class="operator">*</span>pasteboard <span class="operator">=</span> [<span class="type">UIPasteboard</span> generalPasteboard];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">15.0</span>, <span class="operator">*</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pasteboard.hasStrings) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pasteboard.hasURLs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> YYText </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UICollectionView&#39;s isPrefetchingEnabled</title>
      <link href="/blog_web/2024/06/15/my-first-blog/"/>
      <url>/blog_web/2024/06/15/my-first-blog/</url>
      
        <content type="html"><![CDATA[<p>UICollectionView滑动时<code>collectionView(:cellForItemAt:)</code> 的<code>indexPath</code>和当前显示的<code>位置</code>对应不上。</p><p>原因在于UICollectionView的属性isPrefetchingEnabled</p><p>iOS10以上，默认true 即开启预加载 </p><h4 id="isPrefetchingEnabled"><a href="#isPrefetchingEnabled" class="headerlink" title="isPrefetchingEnabled"></a>isPrefetchingEnabled</h4><p>A Boolean value that indicates whether cell and data prefetching are enabled.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var isPrefetchingEnabled: Bool &#123; get <span class="built_in">set</span> &#125;</span><br></pre></td></tr></table></figure><h4 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h4><p>When true, the collection view requests cells in advance of when they will be displayed, spreading the rendering over multiple layout passes. When false, the cells are requested as they are needed for display, often with multiple cells being requested in the same render loop.<br>Setting this property to false also disables data prefetching. The default value of this property is true.</p><blockquote><p>When prefetching is enabled the <code>collectionView(_:cellForItemAt:)</code> method on the collection view delegate is called in advance of when the cell is required. To avoid inconsistencies in the visual appearance, use the <code>collectionView(_:willDisplay:forItemAt:)</code> delegate method to update the cell to reflect visual state such as selection.</p></blockquote><p>Info: <a href="https://developer.apple.com/documentation/uikit/uicollectionview/1771771-isprefetchingenabled?changes=_10">apple.document</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> UICollectionView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/blog_web/2024/06/15/hello-world/"/>
      <url>/blog_web/2024/06/15/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
